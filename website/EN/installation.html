<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title></title>
<!-- 2015-07-05 Sun 20:31 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Bob Mottram" />
<meta  name="description" content="Turn the Beaglebone Black into a personal communications server"
 />
<meta  name="keywords" content="freedombox, debian, beaglebone, red matrix, email, web server, home server, internet, censorship, surveillance, social network, irc, jabber" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css"
href="http://sachachua.com/blog/wp-content/themes/sacha-v3/foundation/css/foundation.min.css"></link>
<link rel="stylesheet" type="text/css" href="http://sachachua.com/org-export.css"></link>
<link rel="stylesheet" type="text/css" href="http://sachachua.com/blog/wp-content/themes/sacha-v3/style.css"></link>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<a name="top" id="top"></a>
</div>
<div id="content">
<div class="center">

<div class="figure">
<p><img src="./images/logo.png" alt="logo.png" />
</p>
</div>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="index.html">Home</a></td>
<td class="org-left"><a href="#orgheadline1">Preparation for the Beaglebone Black</a></td>
<td class="org-left"><a href="#orgheadline2">Checklist</a></td>
<td class="org-left"><a href="#orgheadline3">Interactive Setup</a></td>
<td class="org-left"><a href="#orgheadline4">Non-Interactive Setup</a></td>
<td class="org-left"><a href="#orgheadline5">Post-Setup</a></td>
<td class="org-left"><a href="#orgheadline6">Keydrives</a></td>
<td class="org-left"><a href="#orgheadline7">On Client Machines</a></td>
</tr>
</tbody>
</table>


<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">Preparation for the Beaglebone Black</h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
This section is specific to the Beaglebone Black hardware. If you're not using that hardware then just skip to the next section.
</p>

<p>
To get started you will need:
</p>

<ul class="org-ul">
<li>A Beaglebone Black</li>
<li>A MicroSD card</li>
<li>Ethernet cable</li>
<li>Optionally a 5V 2A power supply for the Beaglebone Black</li>
<li>Access to the internet via a router with ethernet sockets</li>
<li>USB thumb drive (for backups or storing media)</li>
<li>One or more domains available via a dynamic DNS provider, such as <a href="https://freedns.afraid.org/">https://freedns.afraid.org/</a></li>
<li>A purchased domain name and SSL certificate (only needed for Red Matrix)</li>
<li>A laptop or desktop machine with the ability to write to a microSD card (might need an adaptor)</li>
</ul>

<p>
You will also need to know, or find out, the IP address of your internet router and have a suitable static IP address for the Beaglebone on your local network. The router should allow you to forward ports to the Beaglebone (often this is under firewall or "advanced" settings).
</p>

<p>
You can either install from a debian package or manually as follows:
</p>

<div class="org-src-container">

<pre class="src src-bash">sudo apt-get update
sudo apt-get install git dialog build-essential
git clone https://github.com/bashrc/freedombone
<span class="org-builtin">cd</span> freedombone
sudo make install
</pre>
</div>

<p>
Plug the microSD card into your laptop/desktop and then run the <b>freedombone-prep</b> command. For example:
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone-prep -d /dev/sdX --ip freedombone_IP_address --iprouter router_IP_address
</pre>
</div>

<p>
where /dev/sdX is the device name for the microSD card. Often it's /dev/sdb or /dev/sdc, depending upon how many drives there are on your system. The script will download the Debian installer and update the microSD card. It can take a while, so be patient.
</p>

<p>
When the initial setup is done follow the instructions on screen to run the main freedombone command.
</p>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2">Checklist</h2>
<div class="outline-text-2" id="text-orgheadline2">
<p>
Before running the freedombone command you will need a few things.
</p>

<ul class="org-ul">
<li>Have some domains, or subdomains, registered with a dynamic DNS service</li>
<li>System with a new installation of Debian Jessie</li>
<li>Ethernet connection to an internet router</li>
<li>It is possible to forward ports from the internet router to the system</li>
<li>If you want to set up a social network or microblog then you will need SSL certificates corresponding to those domains</li>
<li>Have ssh access to the system</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3">Interactive Setup</h2>
<div class="outline-text-2" id="text-orgheadline3">
<p>
The interactive server configuration setup is recommended for most users. On the system where freedombone is to be installed create a configuration file.
</p>

<div class="org-src-container">

<pre class="src src-bash">ssh myusername@freedombone_IP_address
su
sudo apt-get update
apt-get install git dialog build-essential
git clone https://github.com/bashrc/freedombone
<span class="org-builtin">cd</span> freedombone
make install
</pre>
</div>

<p>
Now the easiest way to install the system is via the interactive setup.
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone menuconfig
</pre>
</div>

<p>
You can select which variant you wish to install and then enter the details as requested. A video of the install sequence can be <a href="./installer.ogv">seen here</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4">Non-Interactive Setup</h2>
<div class="outline-text-2" id="text-orgheadline4">
<p>
If you don't want to install interactively then it's possible to manually create a configuration file as follows:
</p>

<p>
On the system where freedombone is to be installed create a configuration file.
</p>

<div class="org-src-container">

<pre class="src src-bash">ssh myusername@freedombone_IP_address
su
sudo apt-get update
apt-get install git build-essential
git clone https://github.com/bashrc/freedombone
<span class="org-builtin">cd</span> freedombone
make install
nano /home/myusername/freedombone/freedombone.cfg
</pre>
</div>

<p>
Add the following, and set the values as needed. DEFAULT_DOMAIN_NAME is where your email/xmpp/irc/voip will be accessed from. It could be the same as one of your other domains, or separate.
</p>

<div class="org-src-container">

<pre class="src src-bash"><span class="org-variable-name">MY_USERNAME</span>=myusername
<span class="org-variable-name">DEFAULT_DOMAIN_NAME</span>=mywikidomain
<span class="org-variable-name">SYSTEM_TYPE</span>=full
<span class="org-variable-name">INSTALLING_ON_BBB</span>=no
<span class="org-variable-name">DDNS_PROVIDER</span>=default@freedns.afraid.org
<span class="org-variable-name">DDNS_USERNAME</span>=ddnsusername
<span class="org-variable-name">DDNS_PASSWORD</span>=ddnspassword3471326
<span class="org-variable-name">MY_NAME</span>=MyFullNameOrNick
<span class="org-variable-name">MY_EMAIL_ADDRESS</span>=myusername@mywikidomain
<span class="org-variable-name">LOCAL_NETWORK_STATIC_IP_ADDRESS</span>=192.168.1.60
<span class="org-variable-name">ROUTER_IP_ADDRESS</span>=192.168.1.254
<span class="org-variable-name">ENABLE_CJDNS</span>=no
<span class="org-variable-name">DEBIAN_REPO</span>=ftp.us.debian.org
<span class="org-variable-name">NAMESERVER1</span>=85.214.73.63
<span class="org-variable-name">NAMESERVER2</span>=213.73.91.35
<span class="org-variable-name">WIKI_TITLE</span>=my wiki title
<span class="org-variable-name">WIKI_DOMAIN_NAME</span>=mywikidomain
<span class="org-variable-name">MY_BLOG_TITLE</span>=my blog
<span class="org-variable-name">FULLBLOG_DOMAIN_NAME</span>=myblogdomain
<span class="org-variable-name">MICROBLOG_DOMAIN_NAME</span>=mymicroblogdomain
<span class="org-variable-name">REDMATRIX_DOMAIN_NAME</span>=myredmatrixdomain
<span class="org-variable-name">OWNCLOUD_DOMAIN_NAME</span>=myownclouddomain
<span class="org-variable-name">HWRNG_TYPE</span>=haveged
<span class="org-variable-name">ENABLE_SOCIAL_KEY_MANAGEMENT</span>=<span class="org-string">"no"</span>
</pre>
</div>

<p>
Both of the IP addresses are local IP addresses, typically of the form 192.168.x.x, with one being for the system and the other being for the internet router.
</p>

<p>
Save the configuration file and exit from your editor.
</p>

<p>
Now you can begin the installation. If you are doing this on a Beaglebone Black:
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone -c freedombone.cfg
</pre>
</div>

<p>
The above command should be run in the same directory in which your configuration file exists.
</p>

<p>
Also see the manpage for additional options which can be used instead of a configuration file.
</p>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="orgheadline8">Social Key Management</h2>
<div class="outline-text-2" id="text-orgheadline8">
<p>
If you are using the interactive installer then you will be aked if you wish to import GPG keys. If you don't already possess GPG keys then just select "Ok" and they will be generated during the install. If you do already have GPG keys then there are a few possibilities
</p>
</div>

<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9">You have the gnupg keyring on an encrypted USB drive</h3>
<div class="outline-text-3" id="text-orgheadline9">
<p>
If you previously made a master keydrive containing the full keyring (the .gnupg directory). This is the most straightforward case, but not as secure as splitting the key into fragments.
</p>
</div>
</div>
<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10">You have a number of key fragments on USB drives retrieved from friends</h3>
<div class="outline-text-3" id="text-orgheadline10">
<p>
If you previously made some USB drives containing key fragments then retrieve them from your friends and plug them in one after the other. After the last drive has been read then remove it and just select "Ok". The system will then try to reconstruct the key. For this to work you will need to have previously made three or more <a href="#orgheadline6">Keydrives</a>.
</p>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11">You can specify some ssh login details for friends servers containing key fragments</h3>
<div class="outline-text-3" id="text-orgheadline11">
<p>
Enter three or more sets of login details and the installer will try to retrieve key fragments and then assemble them into the full key. This only works if you previously were using remote backups and had social key management enabled.
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5">Post-Setup</h2>
<div class="outline-text-2" id="text-orgheadline5">
<p>
Setup of the server and installation of all the relevant packages is not quick, and depends upon which variant you choose and your internet bandwidth. Allow about three hours for a full installation on the Beaglebone Black. On the Beaglebone installation is in two parts, since a reboot is needed to enable the hardware random number generator and zram.
</p>

<p>
When done you can ssh into the Freedombone with:
</p>

<div class="org-src-container">

<pre class="src src-bash">ssh myusername@domain -p 2222
</pre>
</div>

<p>
Any manual post-installation setup instructions or passwords can be found in /home/username/README. You should remove any passwords from that file and store them within a password manager such as KeepassX.
</p>

<p>
On your internet router, typically under firewall settings, open the following ports and forward them to your server.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Service</th>
<th scope="col" class="org-right">Ports</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">HTTP</td>
<td class="org-right">80</td>
</tr>

<tr>
<td class="org-left">HTTPS</td>
<td class="org-right">443</td>
</tr>

<tr>
<td class="org-left">SSH</td>
<td class="org-right">2222</td>
</tr>

<tr>
<td class="org-left">DLNA</td>
<td class="org-right">1900</td>
</tr>

<tr>
<td class="org-left">DLNA</td>
<td class="org-right">8200</td>
</tr>

<tr>
<td class="org-left">XMPP</td>
<td class="org-right">5222..5223</td>
</tr>

<tr>
<td class="org-left">XMPP</td>
<td class="org-right">5269</td>
</tr>

<tr>
<td class="org-left">XMPP</td>
<td class="org-right">5280..5281</td>
</tr>

<tr>
<td class="org-left">IRC</td>
<td class="org-right">6697</td>
</tr>

<tr>
<td class="org-left">IRC</td>
<td class="org-right">9999</td>
</tr>

<tr>
<td class="org-left">Git</td>
<td class="org-right">9418</td>
</tr>

<tr>
<td class="org-left">Email</td>
<td class="org-right">25</td>
</tr>

<tr>
<td class="org-left">Email</td>
<td class="org-right">587</td>
</tr>

<tr>
<td class="org-left">Email</td>
<td class="org-right">465</td>
</tr>

<tr>
<td class="org-left">Email</td>
<td class="org-right">993</td>
</tr>

<tr>
<td class="org-left">VoIP</td>
<td class="org-right">64738</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-2">
<h2 id="orgheadline6">Keydrives</h2>
<div class="outline-text-2" id="text-orgheadline6">
<p>
After installing for the first time it's a good idea to create some keydrives. These will store your gpg key so that if all else fails you will still be able to restore from backup. There are two ways to do this:
</p>
</div>
<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12">Master Keydrive</h3>
<div class="outline-text-3" id="text-orgheadline12">
<p>
This is the traditional security model in which you carry your full keyring on an encrypted USB drive. To make a master keydrive first format a USB drive as a LUKS encrypted drive. In Ubuntu this can be <a href="https://help.ubuntu.com/community/EncryptedFilesystemsOnRemovableStorage">done from the <i>Disk Utility</i> application</a>. Then plug it into the Freedombone system, then from your local machine run:
</p>

<div class="org-src-container">

<pre class="src src-bash">ssh myusername@mydomainname -p 2222
su
freedombone-keydrive -u myusername -d sdb --master yes
<span class="org-keyword">exit</span>
<span class="org-keyword">exit</span>
</pre>
</div>

<p>
If you are on a Beaglebone Black then use <i>sda</i> rather than <i>sdb</i> for the drive parameter.
</p>
</div>
</div>
<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13">Fragment keydrives</h3>
<div class="outline-text-3" id="text-orgheadline13">
<p>
This breaks your GPG key into a number of fragments and randomly selects one to add to the USB drive. First format a USB drive as a LUKS encrypted drive. In Ubuntu this <a href="https://help.ubuntu.com/community/EncryptedFilesystemsOnRemovableStorage">can be done from the <i>Disk Utility</i> application</a>. Plug it into the Freedombone system then from your local machine run the following commands:
</p>

<div class="org-src-container">

<pre class="src src-bash">ssh myusername@mydomainname -p 2222
su
freedombone-keydrive -u myusername -d sdb
<span class="org-keyword">exit</span>
<span class="org-keyword">exit</span>
</pre>
</div>

<p>
Fragments are randomly assigned and so you will need at least three or four keydrives to have enough fragments to reconstruct your original key in a worst case scenario. You can store fragments for different Freedombone systems on the same encrypted USB drive, so you can help to ensure that your friends can also recover their systems. This might be called "<i>the web of backups</i>" or "<i>the web of encryption</i>". Since you can only write a single key fragment from your Freedombone system to a given USB drive each friend doesn't have enough information to decrypt your backups or steal your identity, even if they turn evil. This is based on the assumption that it may be difficult to get three or more friends to conspire against you all at once.
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-2">
<h2 id="orgheadline7">On Client Machines</h2>
<div class="outline-text-2" id="text-orgheadline7">
<p>
You can configure laptops or desktop machines which connect to the Freedombone server in the following way. This alters encryption settings to improve overall security.
</p>

<div class="org-src-container">

<pre class="src src-bash">sudo apt-get update
sudo apt-get install git dialog haveged build-essential
git clone https://github.com/bashrc/freedombone
<span class="org-builtin">cd</span> freedombone
sudo make install
freedombone-client
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

<style type="text/css">
.back-to-top {
    position: fixed;
    bottom: 2em;
    right: 0px;
    text-decoration: none;
    color: #000000;
    background-color: rgba(235, 235, 235, 0.80);
    font-size: 12px;
    padding: 1em;
    display: none;
}

.back-to-top:hover {
    background-color: rgba(135, 135, 135, 0.50);
}
</style>

<div class="back-to-top">
<a href="#top">Back to top</a> | <a href="mailto:bob@robotics.uk.to">E-mail me</a>
</div>

<script type="text/javascript">
    var offset = 220;
    var duration = 500;
    jQuery(window).scroll(function() {
        if (jQuery(this).scrollTop() > offset) {
            jQuery('.back-to-top').fadeIn(duration);
        } else {
            jQuery('.back-to-top').fadeOut(duration);
        }
    });
</script>
</div>
</body>
</html>
